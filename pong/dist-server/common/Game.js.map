{"version":3,"sources":["../../src/common/Game.js"],"names":["PADDING","WIDTH","HEIGHT","PADDLE_WIDTH","PADDLE_HEIGHT","Paddle","gameEngine","options","props","other","health","Object","assign","type","BaseTypes","TYPES","INT16","DynamicObject","Ball","velocity","percent","Game","physicsEngine","SimplePhysicsEngine","on","gameLogic","bind","serverSideInit","serverSidePlayerJoined","serverSidePlayerDisconnected","clientSideInit","clientSideDraw","serializer","registerClass","paddles","world","queryObjects","instanceType","ball","queryObject","length","position","x","y","console","log","inputData","playerId","playerPaddle","input","addObjectToWorld","playerID","TwoVector","ev","id","controls","KeyboardControls","renderer","clientEngine","bindKey","repeat","updateEl","el","obj","style","top","left","background","toString","document","querySelector","GameEngine"],"mappings":"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","sourcesContent":["import { GameEngine, BaseTypes, TwoVector, DynamicObject, KeyboardControls, SimplePhysicsEngine } from 'lance-gg';\n\nconst PADDING = 20;\nconst WIDTH = 400;\nconst HEIGHT = 400;\nconst PADDLE_WIDTH = 10;\nconst PADDLE_HEIGHT = 50;\n\n// A paddle has a health attribute\nclass Paddle extends DynamicObject {\n\n    constructor(gameEngine, options, props) {\n        super(gameEngine, options, props);\n    }\n\n    static get netScheme() {\n        return Object.assign({\n            health: { type: BaseTypes.TYPES.INT16 }\n        }, super.netScheme);\n    }\n\n    syncTo(other) {\n        super.syncTo(other);\n        this.health = other.health;\n    }\n}\n\n// a game object to represent the ball\nclass Ball extends DynamicObject {\n\n    constructor(gameEngine, options, props) {\n        super(gameEngine, options, props);\n    }\n\n    // avoid gradual synchronization of velocity\n    get bending() {\n        return { velocity: { percent: 0.0 } };\n    }\n\n    syncTo(other) {\n        super.syncTo(other);\n    }\n}\n\nexport default class Game extends GameEngine {\n\n    constructor(options) {\n        super(options);\n        this.physicsEngine = new SimplePhysicsEngine({ gameEngine: this });\n\n        // common code\n        this.on('postStep', this.gameLogic.bind(this));\n\n        // server-only code\n        this.on('server__init', this.serverSideInit.bind(this));\n        this.on('server__playerJoined', this.serverSidePlayerJoined.bind(this));\n        this.on('server__playerDisconnected', this.serverSidePlayerDisconnected.bind(this));\n\n        // client-only code\n        this.on('client__rendererReady', this.clientSideInit.bind(this));\n        this.on('client__draw', this.clientSideDraw.bind(this));\n    }\n\n    registerClasses(serializer) {\n        serializer.registerClass(Paddle);\n        serializer.registerClass(Ball);\n    }\n\n    gameLogic() {\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\n        let ball = this.world.queryObject({ instanceType: Ball });\n        if (!ball || paddles.length !== 2) return;\n\n        // CHECK LEFT EDGE:\n        if (ball.position.x <= PADDING + PADDLE_WIDTH &&\n            ball.position.y >= paddles[0].y && ball.position.y <= paddles[0].position.y + PADDLE_HEIGHT &&\n            ball.velocity.x < 0) {\n\n            // ball moving left hit player 1 paddle\n            ball.velocity.x *= -1;\n            ball.position.x = PADDING + PADDLE_WIDTH + 1;\n        } else if (ball.position.x <= 0) {\n\n            // ball hit left wall\n            ball.velocity.x *= -1;\n            ball.position.x = 0;\n            console.log(`player 2 scored`);\n            paddles[0].health--;\n        }\n\n        // CHECK RIGHT EDGE:\n        if (ball.position.x >= WIDTH - PADDING - PADDLE_WIDTH &&\n            ball.position.y >= paddles[1].position.y && ball.position.y <= paddles[1].position.y + PADDLE_HEIGHT &&\n            ball.velocity.x > 0) {\n\n            // ball moving right hits player 2 paddle\n            ball.velocity.x *= -1;\n            ball.position.x = WIDTH - PADDING - PADDLE_WIDTH - 1;\n        } else if (ball.position.x >= WIDTH ) {\n\n            // ball hit right wall\n            ball.velocity.x *= -1;\n            ball.position.x = WIDTH - 1;\n            console.log(`player 1 scored`);\n            paddles[1].health--;\n        }\n\n        // ball hits top or bottom edge\n        if (ball.position.y <= 0) {\n            ball.position.y = 1;\n            ball.velocity.y *= -1;\n        } else if (ball.position.y >= HEIGHT) {\n            ball.position.y = HEIGHT - 1;\n            ball.velocity.y *= -1;\n        }\n    }\n\n    processInput(inputData, playerId) {\n        super.processInput(inputData, playerId);\n\n        // get the player paddle tied to the player socket\n        let playerPaddle = this.world.queryObject({ playerId });\n        if (playerPaddle) {\n            if (inputData.input === 'up') {\n                playerPaddle.position.y -= 5;\n            } else if (inputData.input === 'down') {\n                playerPaddle.position.y += 5;\n            }\n        }\n    }\n\n    //\n    // SERVER ONLY CODE\n    //\n    serverSideInit() {\n        // create the paddles and the ball\n        this.addObjectToWorld(new Paddle(this, null, { playerID: 0, position: new TwoVector(PADDING, 0) }));\n        this.addObjectToWorld(new Paddle(this, null, { playerID: 1, position: new TwoVector(WIDTH - PADDING, 0) }));\n        this.addObjectToWorld(new Ball(this, null, {\n            position: new TwoVector(WIDTH /2, HEIGHT / 2),\n            velocity: new TwoVector(2, 2)\n        }));\n    }\n\n    // attach newly connected player to next available paddle\n    serverSidePlayerJoined(ev) {\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\n        if (paddles[0].playerId === 0) {\n            paddles[0].playerId = ev.playerId;\n        } else if (paddles[1].playerId === 0) {\n            paddles[1].playerId = ev.playerId;\n        }\n    }\n\n    serverSidePlayerDisconnected(ev) {\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\n        if (paddles[0].playerId === ev.id) {\n            paddles[0].playerId = 0;\n        } else if (paddles[1].playerId === ev.id) {\n            paddles[1].playerId = 0;\n        }\n    }\n\n    //\n    // CLIENT ONLY CODE\n    //\n    clientSideInit() {\n        this.controls = new KeyboardControls(this.renderer.clientEngine);\n        this.controls.bindKey('up', 'up', { repeat: true } );\n        this.controls.bindKey('down', 'down', { repeat: true } );\n    }\n\n    clientSideDraw() {\n\n        function updateEl(el, obj) {\n            let health = obj.health>0?obj.health:15;\n            el.style.top = obj.position.y + 10 + 'px';\n            el.style.left = obj.position.x + 'px';\n            el.style.background = `#ff${health.toString(16)}f${health.toString(16)}f`;\n        }\n\n        let paddles = this.world.queryObjects({ instanceType: Paddle });\n        let ball = this.world.queryObject({ instanceType: Ball });\n        if (!ball || paddles.length !== 2) return;\n        updateEl(document.querySelector('.ball'), ball);\n        updateEl(document.querySelector('.paddle1'), paddles[0]);\n        updateEl(document.querySelector('.paddle2'), paddles[1]);\n    }\n}\n"],"file":"Game.js"}